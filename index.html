<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beautiful Quote Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Lora:ital,wght@0,400;0,700;1,400&family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Oswald:wght@400;600&family=Dancing+Script:wght@400;700&family=Bebas+Neue&display=swap');
        
        <!-- QR Code Library -->
        <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
        
        body {
            font-family: 'Playfair Display', Georgia, serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .input-section {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .image-preview {
            margin-top: 10px;
            text-align: center;
        }

        .remove-image-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .remove-image-btn:hover {
            background: #ff3742;
        }

        .overlay-controls {
            margin-top: 15px;
            display: none;
        }

        .overlay-controls label {
            display: inline-block;
            margin-right: 15px;
            font-size: 14px;
        }

        .overlay-controls input[type="range"] {
            width: 120px;
            margin-left: 8px;
        }

        .styling-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .styling-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .style-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .style-group label {
            font-size: 14px;
            font-weight: 600;
            color: #555;
        }

        select, input[type="color"], input[type="number"] {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input[type="color"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .color-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .range-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-input input[type="range"] {
            flex: 1;
        }

        .range-value {
            min-width: 30px;
            font-size: 12px;
            color: #666;
        }

        .advanced-toggle {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .advanced-toggle:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .advanced-toggle h3 {
            margin: 0;
            color: #667eea;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .toggle-icon {
            transition: transform 0.3s;
            font-size: 14px;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .advanced-content {
            display: none;
            margin-top: 20px;
        }

        .advanced-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .template-library {
            margin: 20px 0;
        }

        .template-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .category-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .category-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .template-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .template-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .template-preview {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
            position: relative;
            overflow: hidden;
        }

        .template-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .template-description {
            font-size: 12px;
            color: #666;
        }

        .template-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .template-option {
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
            font-size: 14px;
            font-weight: 500;
        }

        .template-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .template-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .quote-preview {
            margin-top: 30px;
            text-align: center;
        }

        .quote-canvas {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .download-section {
            display: none;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .download-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-png {
            background: #4CAF50;
            color: white;
        }

        .download-jpg {
            background: #2196F3;
            color: white;
        }

        .copy-clipboard {
            background: #9c27b0;
            color: white;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .template-minimal {
            background: linear-gradient(45deg, #f0f0f0, #ffffff);
            color: #333;
        }

        .template-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .template-dark {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
        }

        .template-warm {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: #333;
        }

        .template-nature {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        /* Template Library Styles */
        .template-library {
            margin-top: 15px;
        }

        .template-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .category-btn.active,
        .category-btn:hover {
            background: #667eea;
            color: white;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .template-preview {
            height: 120px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .template-text {
            font-size: 16px;
            line-height: 1.4;
            text-align: center;
            word-wrap: break-word;
        }

        .template-info {
            padding: 15px;
            border-top: 1px solid #f0f0f0;
            background: #fafafa;
        }

        .template-info h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #333;
        }

        .template-info p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        /* Template theme backgrounds for preview cards */
        .template-card.template-minimal .template-preview {
            background: linear-gradient(45deg, #f0f0f0, #ffffff);
            color: #2c2c2c;
        }

        .template-card.template-gradient .template-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .template-card.template-dark .template-preview {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
        }

        .template-card.template-warm .template-preview {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: #5d4037;
        }

        .template-card.template-nature .template-preview {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2e7d32;
        }

        .template-card.template-ocean .template-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .template-card.template-sunset .template-preview {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
        }

        .template-card.template-royal .template-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .template-card.template-vintage .template-preview {
            background: linear-gradient(135deg, #8b7355 0%, #a0895a 100%);
            color: white;
        }

        .template-card.template-neon .template-preview {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #00f5ff;
        }

        .template-card.template-forest .template-preview {
            background: linear-gradient(135deg, #2d5016 0%, #3e6b1f 100%);
            color: white;
        }

        .template-card.template-rose .template-preview {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Beautiful Quote Generator</h1>
            <p>Transform your text into stunning visual quotes perfect for social media</p>
        </div>
        
        <div class="input-section">
            <div class="form-group">
                <label for="quote-text">Your Quote:</label>
                <textarea id="quote-text" placeholder="Enter your inspirational quote here..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="author-name">Author (optional):</label>
                <input type="text" id="author-name" placeholder="Quote author">
            </div>
            
            <div class="form-group">
                <label for="custom-image">Custom Background Image (optional):</label>
                <input type="file" id="custom-image" accept="image/*" onchange="handleImageUpload(event)">
                <div class="image-preview" id="image-preview" style="display: none;">
                    <img id="preview-img" style="max-width: 100%; max-height: 150px; border-radius: 8px; margin-top: 10px;">
                    <button type="button" class="remove-image-btn" onclick="removeImage()">Remove Image</button>
                </div>
                <div class="overlay-controls" id="overlay-controls">
                    <label>Overlay Opacity: <input type="range" id="overlay-opacity" min="0" max="80" value="40" oninput="updateOverlayPreview()">%</label>
                    <label>Blur: <input type="range" id="background-blur" min="0" max="10" value="2" oninput="updateOverlayPreview()">px</label>
                </div>
            </div>
            
            <!-- Advanced Features Toggle -->
            <div class="advanced-toggle" onclick="toggleAdvanced()">
                <h3>
                    ⚙️ Advanced Features
                    <span class="toggle-icon" id="advanced-icon">▼</span>
                </h3>
            </div>

            <div class="advanced-content" id="advanced-content">
                <div class="form-group">
                    <label for="canvas-size">Canvas Size:</label>
                    <select id="canvas-size" onchange="updateCanvasSize()">
                        <option value="instagram-post">Instagram Post (1080x1080)</option>
                        <option value="instagram-story">Instagram Story (1080x1920)</option>
                        <option value="facebook-post">Facebook Post (1200x630)</option>
                        <option value="twitter-post">Twitter Post (1200x675)</option>
                        <option value="linkedin-post">LinkedIn Post (1200x627)</option>
                        <option value="pinterest-pin">Pinterest Pin (1000x1500)</option>
                        <option value="youtube-thumbnail">YouTube Thumbnail (1280x720)</option>
                        <option value="custom">Custom Size</option>
                    </select>
                </div>

                <div class="form-group" id="custom-size-group" style="display: none;">
                    <label>Custom Dimensions:</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="custom-width" placeholder="Width" min="400" max="2400" value="1080" style="width: 100px;">
                        <span>×</span>
                        <input type="number" id="custom-height" placeholder="Height" min="400" max="2400" value="1080" style="width: 100px;">
                        <button type="button" onclick="applyCustomSize()" style="padding: 8px 12px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">Apply</button>
                    </div>
                </div>

                <!-- Template Library Section -->
                <div class="styling-section">
                    <h3>📚 Template Library</h3>
                    <div class="template-library">
                        <div class="template-categories">
                            <div class="category-btn active" data-category="all" onclick="filterTemplates('all')">All</div>
                            <div class="category-btn" data-category="motivational" onclick="filterTemplates('motivational')">Motivational</div>
                            <div class="category-btn" data-category="business" onclick="filterTemplates('business')">Business</div>
                            <div class="category-btn" data-category="holiday" onclick="filterTemplates('holiday')">Holiday</div>
                            <div class="category-btn" data-category="quotes" onclick="filterTemplates('quotes')">Quotes</div>
                            <div class="category-btn" data-category="announcements" onclick="filterTemplates('announcements')">Announcements</div>
                        </div>
                        <div class="template-grid" id="template-grid">
                            <!-- Templates will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- QR Code Section -->
                <div class="styling-section">
                    <h3>🔗 QR Code</h3>
                    <div class="style-grid">
                        <div class="style-group">
                            <label>Enable QR Code</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="enable-qr" onchange="updatePreview()"> Add QR Code</label>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="qr-url">QR Code URL</label>
                            <input type="text" id="qr-url" value="https://bazlur.ca" onchange="updatePreview()" placeholder="https://your-website.com">
                        </div>

                        <div class="style-group">
                            <label for="qr-position">Position</label>
                            <select id="qr-position" onchange="updatePreview()">
                                <option value="bottom-right">Bottom Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="top-left">Top Left</option>
                            </select>
                        </div>

                        <div class="style-group">
                            <label for="qr-size">Size</label>
                            <div class="range-input">
                                <input type="range" id="qr-size" min="60" max="200" value="100" oninput="updateQRSizeDisplay(); updatePreview()">
                                <span class="range-value" id="qr-size-value">100px</span>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="qr-background">Background</label>
                            <select id="qr-background" onchange="updatePreview()">
                                <option value="white">White</option>
                                <option value="transparent">Transparent</option>
                                <option value="custom">Custom Color</option>
                            </select>
                        </div>

                        <div class="style-group" id="qr-color-group" style="display: none;">
                            <label for="qr-bg-color">Background Color</label>
                            <input type="color" id="qr-bg-color" value="#ffffff" onchange="updatePreview()">
                        </div>
                    </div>
                </div>

                <!-- Text Styling Section -->
                <div class="styling-section">
                    <h3>✨ Text Styling</h3>
                    <div class="style-grid">
                        <div class="style-group">
                            <label for="font-family">Font Family</label>
                            <select id="font-family" onchange="updatePreview()">
                                <option value="Playfair Display">Playfair Display (Elegant)</option>
                                <option value="Inter">Inter (Modern)</option>
                                <option value="Merriweather">Merriweather (Classic)</option>
                                <option value="Montserrat">Montserrat (Clean)</option>
                                <option value="Open Sans">Open Sans (Friendly)</option>
                                <option value="Lora">Lora (Readable)</option>
                                <option value="Crimson Text">Crimson Text (Literary)</option>
                                <option value="Oswald">Oswald (Bold)</option>
                                <option value="Dancing Script">Dancing Script (Script)</option>
                                <option value="Bebas Neue">Bebas Neue (Display)</option>
                            </select>
                        </div>

                        <div class="style-group">
                            <label>Style Presets</label>
                            <select id="style-presets" onchange="applyPreset()">
                                <option value="">Choose a preset...</option>
                                <option value="elegant">Elegant Classic</option>
                                <option value="modern">Modern Minimal</option>
                                <option value="bold">Bold Impact</option>
                                <option value="script">Script Artistic</option>
                                <option value="professional">Professional</option>
                                <option value="social">Social Media</option>
                            </select>
                        </div>

                        <div class="style-group">
                            <label>Text Style</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="text-bold" onchange="updatePreview()"> Bold</label>
                                <label><input type="checkbox" id="text-italic" onchange="updatePreview()"> Italic</label>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="text-align">Text Alignment</label>
                            <select id="text-align" onchange="updatePreview()">
                                <option value="center">Center</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                        </div>

                        <div class="style-group">
                            <label for="font-size">Font Size</label>
                            <div class="range-input">
                                <input type="range" id="font-size" min="20" max="100" value="50" oninput="updateFontSizeDisplay(); updatePreview()">
                                <span class="range-value" id="font-size-value">Auto</span>
                            </div>
                            <small style="color: #666;">Use slider for fixed size, or leave at 50 for auto-sizing</small>
                        </div>

                        <div class="style-group">
                            <label for="line-spacing">Line Spacing</label>
                            <div class="range-input">
                                <input type="range" id="line-spacing" min="1.0" max="2.5" step="0.1" value="1.4" oninput="updateLineSpacingDisplay(); updatePreview()">
                                <span class="range-value" id="line-spacing-value">1.4</span>
                            </div>
                        </div>

                        <div class="style-group">
                            <label>Text Colors</label>
                            <div class="color-inputs">
                                <div>
                                    <small>Quote</small>
                                    <input type="color" id="quote-color" value="#ffffff" onchange="updatePreview()">
                                </div>
                                <div>
                                    <small>Author</small>
                                    <input type="color" id="author-color" value="#e0e0e0" onchange="updatePreview()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style="margin-top: 20px;">🎨 Text Effects</h3>
                    <div class="style-grid">
                        <div class="style-group">
                            <label for="text-shadow">Text Shadow</label>
                            <div class="range-input">
                                <input type="range" id="text-shadow" min="0" max="10" value="2" oninput="updateShadowDisplay(); updatePreview()">
                                <span class="range-value" id="shadow-value">2px</span>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="text-stroke">Text Outline</label>
                            <div class="range-input">
                                <input type="range" id="text-stroke" min="0" max="5" value="0" oninput="updateStrokeDisplay(); updatePreview()">
                                <span class="range-value" id="stroke-value">0px</span>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="stroke-color">Outline Color</label>
                            <input type="color" id="stroke-color" value="#000000" onchange="updatePreview()">
                        </div>

                        <div class="style-group">
                            <label>Quote Marks</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="show-quotes" checked onchange="updatePreview()"> Show Quotes</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Watermark Section -->
                <div class="styling-section">
                    <h3>🏷️ Watermark</h3>
                    <div class="style-grid">
                        <div class="style-group">
                            <label>Enable Watermark</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="enable-watermark" checked onchange="updatePreview()"> Add Watermark</label>
                            </div>
                        </div>

                        <div class="style-group">
                            <label>Watermark Type</label>
                            <select id="watermark-type" onchange="toggleWatermarkType()">
                                <option value="text">Text</option>
                                <option value="logo">Logo</option>
                            </select>
                        </div>

                        <div class="style-group" id="text-watermark-group">
                            <label for="watermark-text">Watermark Text</label>
                            <input type="text" id="watermark-text" value="bazlur.ca" onchange="updatePreview()" placeholder="Your watermark text">
                        </div>

                        <div class="style-group" id="logo-watermark-group" style="display: none;">
                            <label for="logo-upload">Upload Logo</label>
                            <input type="file" id="logo-upload" accept="image/*" onchange="handleLogoUpload(event)">
                            <div class="image-preview" id="logo-preview" style="display: none;">
                                <img id="preview-logo" style="max-width: 100%; max-height: 80px; border-radius: 8px; margin-top: 10px;">
                                <button type="button" class="remove-image-btn" onclick="removeLogo()">Remove Logo</button>
                            </div>
                        </div>

                        <div class="style-group">
                            <label for="watermark-position">Position</label>
                            <select id="watermark-position" onchange="updatePreview()">
                                <option value="bottom-right">Bottom Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="top-left">Top Left</option>
                                <option value="bottom-center">Bottom Center</option>
                            </select>
                        </div>

                        <div class="style-group">
                            <label for="watermark-opacity">Opacity</label>
                            <div class="range-input">
                                <input type="range" id="watermark-opacity" min="10" max="100" value="60" oninput="updateWatermarkOpacityDisplay(); updatePreview()">
                                <span class="range-value" id="watermark-opacity-value">60%</span>
                            </div>
                        </div>

                        <div class="style-group" id="text-size-group">
                            <label for="watermark-size">Text Size</label>
                            <div class="range-input">
                                <input type="range" id="watermark-size" min="12" max="32" value="18" oninput="updateWatermarkSizeDisplay(); updatePreview()">
                                <span class="range-value" id="watermark-size-value">18px</span>
                            </div>
                        </div>

                        <div class="style-group" id="logo-size-group" style="display: none;">
                            <label for="logo-size">Logo Size</label>
                            <div class="range-input">
                                <input type="range" id="logo-size" min="30" max="150" value="60" oninput="updateLogoSizeDisplay(); updatePreview()">
                                <span class="range-value" id="logo-size-value">60px</span>
                            </div>
                        </div>

                        <div class="style-group" id="text-color-group">
                            <label for="watermark-color">Text Color</label>
                            <input type="color" id="watermark-color" value="#ffffff" onchange="updatePreview()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Choose Template:</label>
                <div class="template-selector">
                    <div class="template-option selected" data-template="minimal">Minimal</div>
                    <div class="template-option" data-template="gradient">Gradient</div>
                    <div class="template-option" data-template="dark">Dark</div>
                    <div class="template-option" data-template="warm">Warm</div>
                    <div class="template-option" data-template="nature">Nature</div>
                    <div class="template-option" data-template="ocean">Ocean</div>
                    <div class="template-option" data-template="sunset">Sunset</div>
                    <div class="template-option" data-template="royal">Royal</div>
                    <div class="template-option" data-template="vintage">Vintage</div>
                    <div class="template-option" data-template="neon">Neon</div>
                    <div class="template-option" data-template="forest">Forest</div>
                    <div class="template-option" data-template="rose">Rose Gold</div>
                </div>
            </div>

            
            <button class="generate-btn" onclick="generateQuote()">Generate Quote</button>
            
            <div class="quote-preview">
                <canvas id="quote-canvas" class="quote-canvas"></canvas>
                <div class="download-section" id="download-section">
                    <button class="download-btn copy-clipboard" onclick="copyToClipboard()">📋 Copy to Clipboard</button>
                    <button class="download-btn download-png" onclick="downloadQuote('png')">📥 Download PNG</button>
                    <button class="download-btn download-jpg" onclick="downloadQuote('jpg')">📥 Download JPG</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedTemplate = 'minimal';
        let customBackgroundImage = null;
        let logoImage = null;
        let selectedQuoteTemplate = null;
        let qrCodeDataURL = null;
        const canvas = document.getElementById('quote-canvas');
        const ctx = canvas.getContext('2d');
        
        // Canvas size configurations
        const canvasSizes = {
            'instagram-post': { width: 1080, height: 1080, name: 'Instagram Post' },
            'instagram-story': { width: 1080, height: 1920, name: 'Instagram Story' },
            'facebook-post': { width: 1200, height: 630, name: 'Facebook Post' },
            'twitter-post': { width: 1200, height: 675, name: 'Twitter Post' },
            'linkedin-post': { width: 1200, height: 627, name: 'LinkedIn Post' },
            'pinterest-pin': { width: 1000, height: 1500, name: 'Pinterest Pin' },
            'youtube-thumbnail': { width: 1280, height: 720, name: 'YouTube Thumbnail' },
            'custom': { width: 1080, height: 1080, name: 'Custom' }
        };
        
        let currentCanvasSize = 'instagram-post';
        
        // Set initial canvas size
        canvas.width = canvasSizes[currentCanvasSize].width;
        canvas.height = canvasSizes[currentCanvasSize].height;

        // Template Library Data
        const quoteTemplates = {
            motivational: [
                {
                    id: 'success-driven',
                    name: 'Success Driven',
                    category: 'motivational',
                    description: 'Bold text with achievement focus',
                    style: {
                        fontFamily: 'Oswald',
                        fontSize: 'auto',
                        isBold: true,
                        textAlign: 'center',
                        lineSpacing: 1.2,
                        quoteColor: '#ffffff',
                        textShadow: 3,
                        showQuotes: false
                    },
                    theme: 'gradient',
                    sampleText: 'Success is not final, failure is not fatal'
                },
                {
                    id: 'calm-motivation',
                    name: 'Calm Motivation',
                    category: 'motivational', 
                    description: 'Elegant serif with peaceful vibes',
                    style: {
                        fontFamily: 'Playfair Display',
                        fontSize: 'auto',
                        isBold: false,
                        textAlign: 'center',
                        lineSpacing: 1.6,
                        quoteColor: '#2c3e50',
                        textShadow: 1,
                        showQuotes: true
                    },
                    theme: 'minimal',
                    sampleText: 'Every moment is a fresh beginning'
                }
            ],
            business: [
                {
                    id: 'professional-impact',
                    name: 'Professional Impact',
                    category: 'business',
                    description: 'Clean corporate styling',
                    style: {
                        fontFamily: 'Inter',
                        fontSize: 'auto',
                        isBold: false,
                        textAlign: 'left',
                        lineSpacing: 1.4,
                        quoteColor: '#1a1a1a',
                        textShadow: 0,
                        showQuotes: false
                    },
                    theme: 'minimal',
                    sampleText: 'Innovation distinguishes between a leader and a follower'
                },
                {
                    id: 'executive-style',
                    name: 'Executive Style',
                    category: 'business',
                    description: 'Premium dark theme for leadership',
                    style: {
                        fontFamily: 'Merriweather',
                        fontSize: 'auto',
                        isBold: true,
                        textAlign: 'center',
                        lineSpacing: 1.5,
                        quoteColor: '#ffffff',
                        textShadow: 2,
                        showQuotes: true
                    },
                    theme: 'dark',
                    sampleText: 'Excellence is never an accident'
                }
            ],
            holiday: [
                {
                    id: 'festive-cheer',
                    name: 'Festive Cheer',
                    category: 'holiday',
                    description: 'Warm colors for celebrations',
                    style: {
                        fontFamily: 'Dancing Script',
                        fontSize: 'auto',
                        isBold: false,
                        textAlign: 'center',
                        lineSpacing: 1.4,
                        quoteColor: '#d4af37',
                        textShadow: 2,
                        showQuotes: false
                    },
                    theme: 'warm',
                    sampleText: 'May your holidays be filled with joy'
                }
            ],
            quotes: [
                {
                    id: 'classic-wisdom',
                    name: 'Classic Wisdom',
                    category: 'quotes',
                    description: 'Traditional quote styling',
                    style: {
                        fontFamily: 'Crimson Text',
                        fontSize: 'auto',
                        isBold: false,
                        textAlign: 'center',
                        lineSpacing: 1.5,
                        quoteColor: '#2e7d32',
                        textShadow: 1,
                        showQuotes: true
                    },
                    theme: 'nature',
                    sampleText: 'The only way to do great work is to love what you do'
                }
            ],
            announcements: [
                {
                    id: 'bold-announcement',
                    name: 'Bold Announcement',
                    category: 'announcements',
                    description: 'Eye-catching for important news',
                    style: {
                        fontFamily: 'Bebas Neue',
                        fontSize: 'auto',
                        isBold: false,
                        textAlign: 'center',
                        lineSpacing: 1.1,
                        quoteColor: '#ff007f',
                        textShadow: 3,
                        textStroke: 2,
                        strokeColor: '#ffffff',
                        showQuotes: false
                    },
                    theme: 'neon',
                    sampleText: 'Big News Coming Soon!'
                }
            ]
        };

        // Template selection
        document.querySelectorAll('.template-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.template-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedTemplate = this.dataset.template;
            });
        });

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customBackgroundImage = new Image();
                    customBackgroundImage.onload = function() {
                        document.getElementById('preview-img').src = e.target.result;
                        document.getElementById('image-preview').style.display = 'block';
                        document.getElementById('overlay-controls').style.display = 'block';
                    };
                    customBackgroundImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage() {
            customBackgroundImage = null;
            document.getElementById('custom-image').value = '';
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('overlay-controls').style.display = 'none';
        }

        function updateOverlayPreview() {
            // This function could be used to show live preview updates
            // For now, user will see changes when they generate the quote
        }

        // Styling control functions
        function updateFontSizeDisplay() {
            const value = document.getElementById('font-size').value;
            document.getElementById('font-size-value').textContent = value == 50 ? 'Auto' : value + 'px';
        }

        function updateLineSpacingDisplay() {
            const value = document.getElementById('line-spacing').value;
            document.getElementById('line-spacing-value').textContent = value;
        }

        function updateShadowDisplay() {
            const value = document.getElementById('text-shadow').value;
            document.getElementById('shadow-value').textContent = value + 'px';
        }

        function updateStrokeDisplay() {
            const value = document.getElementById('text-stroke').value;
            document.getElementById('stroke-value').textContent = value + 'px';
        }

        function updateWatermarkOpacityDisplay() {
            const value = document.getElementById('watermark-opacity').value;
            document.getElementById('watermark-opacity-value').textContent = value + '%';
        }

        function updateWatermarkSizeDisplay() {
            const value = document.getElementById('watermark-size').value;
            document.getElementById('watermark-size-value').textContent = value + 'px';
        }

        function updateLogoSizeDisplay() {
            const value = document.getElementById('logo-size').value;
            document.getElementById('logo-size-value').textContent = value + 'px';
        }

        function updateQRSizeDisplay() {
            const value = document.getElementById('qr-size').value;
            document.getElementById('qr-size-value').textContent = value + 'px';
        }

        // Template Library Functions
        function initializeTemplateLibrary() {
            populateTemplateGrid('all');
        }

        function filterTemplates(category) {
            // Update active category button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            populateTemplateGrid(category);
        }

        function populateTemplateGrid(category) {
            const grid = document.getElementById('template-grid');
            grid.innerHTML = '';
            
            const allTemplates = Object.values(quoteTemplates).flat();
            const filteredTemplates = category === 'all' ? allTemplates : allTemplates.filter(t => t.category === category);
            
            filteredTemplates.forEach(template => {
                const card = createTemplateCard(template);
                grid.appendChild(card);
            });
        }

        function createTemplateCard(template) {
            const card = document.createElement('div');
            card.className = 'template-card';
            card.dataset.templateId = template.id;
            card.onclick = () => applyTemplate(template);
            
            card.innerHTML = `
                <div class="template-preview" style="background: ${getTemplatePreviewBg(template.theme)}; color: ${template.style.quoteColor}; font-family: '${template.style.fontFamily}', serif;">
                    "${template.sampleText.substring(0, 30)}${template.sampleText.length > 30 ? '...' : ''}"
                </div>
                <div class="template-name">${template.name}</div>
                <div class="template-description">${template.description}</div>
            `;
            
            return card;
        }

        function getTemplatePreviewBg(theme) {
            const themes = {
                minimal: 'linear-gradient(135deg, #fafafa, #ffffff)',
                gradient: 'linear-gradient(135deg, #667eea, #764ba2)',
                dark: 'linear-gradient(135deg, #1a1a1a, #2d3748)',
                warm: 'linear-gradient(135deg, #ffecd2, #fcb69f)',
                nature: 'linear-gradient(135deg, #d299c2, #fef9d7)',
                neon: 'linear-gradient(135deg, #1a1a2e, #16213e)'
            };
            return themes[theme] || themes.minimal;
        }

        function applyTemplate(template) {
            // Clear previous selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select current template
            document.querySelector(`[data-template-id="${template.id}"]`).classList.add('selected');
            
            // Apply template settings
            selectedQuoteTemplate = template;
            selectedTemplate = template.theme;
            
            // Update template theme selector
            document.querySelectorAll('.template-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-template="${template.theme}"]`).classList.add('selected');
            
            // Apply text styling
            document.getElementById('font-family').value = template.style.fontFamily;
            document.getElementById('text-bold').checked = template.style.isBold;
            document.getElementById('text-italic').checked = template.style.isItalic || false;
            document.getElementById('text-align').value = template.style.textAlign;
            document.getElementById('line-spacing').value = template.style.lineSpacing;
            document.getElementById('quote-color').value = template.style.quoteColor;
            document.getElementById('text-shadow').value = template.style.textShadow;
            document.getElementById('show-quotes').checked = template.style.showQuotes;
            
            if (template.style.textStroke) {
                document.getElementById('text-stroke').value = template.style.textStroke;
                document.getElementById('stroke-color').value = template.style.strokeColor;
            }
            
            // Update displays
            updateLineSpacingDisplay();
            updateShadowDisplay();
            updateStrokeDisplay();
            
            // Update preview
            updatePreview();
        }

        // QR Code Functions
        async function generateQRCode() {
            const url = document.getElementById('qr-url').value.trim();
            if (!url) return null;
            
            try {
                const qrDataURL = await QRCode.toDataURL(url, {
                    width: 200,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
                return qrDataURL;
            } catch (error) {
                console.error('QR Code generation failed:', error);
                return null;
            }
        }

        function toggleWatermarkType() {
            const type = document.getElementById('watermark-type').value;
            const textGroup = document.getElementById('text-watermark-group');
            const logoGroup = document.getElementById('logo-watermark-group');
            const textSizeGroup = document.getElementById('text-size-group');
            const logoSizeGroup = document.getElementById('logo-size-group');
            const textColorGroup = document.getElementById('text-color-group');

            if (type === 'text') {
                textGroup.style.display = 'block';
                logoGroup.style.display = 'none';
                textSizeGroup.style.display = 'block';
                logoSizeGroup.style.display = 'none';
                textColorGroup.style.display = 'block';
            } else {
                textGroup.style.display = 'none';
                logoGroup.style.display = 'block';
                textSizeGroup.style.display = 'none';
                logoSizeGroup.style.display = 'block';
                textColorGroup.style.display = 'none';
            }
            updatePreview();
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoImage = new Image();
                    logoImage.onload = function() {
                        document.getElementById('preview-logo').src = e.target.result;
                        document.getElementById('logo-preview').style.display = 'block';
                        updatePreview();
                    };
                    logoImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeLogo() {
            logoImage = null;
            document.getElementById('logo-upload').value = '';
            document.getElementById('logo-preview').style.display = 'none';
            updatePreview();
        }

        function updateCanvasSize() {
            const sizeSelector = document.getElementById('canvas-size');
            const customGroup = document.getElementById('custom-size-group');
            
            currentCanvasSize = sizeSelector.value;
            
            if (currentCanvasSize === 'custom') {
                customGroup.style.display = 'block';
                return; // Don't resize yet, wait for user to apply custom dimensions
            } else {
                customGroup.style.display = 'none';
                const size = canvasSizes[currentCanvasSize];
                canvas.width = size.width;
                canvas.height = size.height;
                
                // Update preview if text exists
                updatePreview();
            }
        }

        function applyCustomSize() {
            const width = parseInt(document.getElementById('custom-width').value);
            const height = parseInt(document.getElementById('custom-height').value);
            
            if (width && height && width >= 400 && width <= 2400 && height >= 400 && height <= 2400) {
                canvas.width = width;
                canvas.height = height;
                canvasSizes.custom.width = width;
                canvasSizes.custom.height = height;
                
                // Update preview if text exists
                updatePreview();
            } else {
                alert('Please enter valid dimensions between 400 and 2400 pixels');
            }
        }

        function toggleAdvanced() {
            const content = document.getElementById('advanced-content');
            const icon = document.getElementById('advanced-icon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.classList.remove('expanded');
                icon.textContent = '▼';
            } else {
                content.classList.add('show');
                icon.classList.add('expanded');
                icon.textContent = '▲';
            }
        }

        async function updatePreview() {
            // Auto-generate preview if text exists
            const quoteText = document.getElementById('quote-text').value.trim();
            if (quoteText) {
                const authorName = document.getElementById('author-name').value.trim();
                
                // Generate QR code if enabled
                const customStyles = getCustomStyles();
                if (customStyles.enableQR && customStyles.qrUrl) {
                    await generateQRCode();
                }
                
                drawQuote(quoteText, authorName, selectedTemplate);
            }
        }

        function getCustomStyles() {
            return {
                fontFamily: document.getElementById('font-family').value,
                isBold: document.getElementById('text-bold').checked,
                isItalic: document.getElementById('text-italic').checked,
                textAlign: document.getElementById('text-align').value,
                fontSize: document.getElementById('font-size').value,
                lineSpacing: parseFloat(document.getElementById('line-spacing').value),
                quoteColor: document.getElementById('quote-color').value,
                authorColor: document.getElementById('author-color').value,
                textShadow: parseInt(document.getElementById('text-shadow').value),
                textStroke: parseInt(document.getElementById('text-stroke').value),
                strokeColor: document.getElementById('stroke-color').value,
                showQuotes: document.getElementById('show-quotes').checked,
                enableWatermark: document.getElementById('enable-watermark').checked,
                watermarkType: document.getElementById('watermark-type').value,
                watermarkText: document.getElementById('watermark-text').value,
                watermarkPosition: document.getElementById('watermark-position').value,
                watermarkOpacity: parseInt(document.getElementById('watermark-opacity').value),
                watermarkSize: parseInt(document.getElementById('watermark-size').value),
                logoSize: parseInt(document.getElementById('logo-size').value),
                watermarkColor: document.getElementById('watermark-color').value,
                enableQR: document.getElementById('enable-qr').checked,
                qrUrl: document.getElementById('qr-url').value,
                qrPosition: document.getElementById('qr-position').value,
                qrSize: parseInt(document.getElementById('qr-size').value),
                qrBackground: document.getElementById('qr-background').value,
                qrBgColor: document.getElementById('qr-bg-color').value
            };
        }

        async function generateQuote() {
            const quoteText = document.getElementById('quote-text').value.trim();
            const authorName = document.getElementById('author-name').value.trim();
            
            if (!quoteText) {
                alert('Please enter a quote text');
                return;
            }

            // Generate QR code if enabled
            const customStyles = getCustomStyles();
            if (customStyles.enableQR) {
                qrCodeDataURL = await generateQRCode();
            }

            drawQuote(quoteText, authorName, selectedTemplate);
            document.getElementById('download-section').style.display = 'flex';
        }

        function drawQuote(text, author, template) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Check if we should use custom background image
            if (customBackgroundImage) {
                drawCustomImageBackground();
            } else {
                drawGradientBackground(template);
            }
            
            // Draw quote content
            drawQuoteContent(text, author, template);
        }

        function drawCustomImageBackground() {
            // Get overlay settings
            const overlayOpacity = document.getElementById('overlay-opacity').value / 100;
            const blurAmount = document.getElementById('background-blur').value;
            
            // Save context state
            ctx.save();
            
            // Apply blur if specified
            if (blurAmount > 0) {
                ctx.filter = `blur(${blurAmount}px)`;
            }
            
            // Calculate image scaling to fill canvas while maintaining aspect ratio
            const scale = Math.max(canvas.width / customBackgroundImage.width, canvas.height / customBackgroundImage.height);
            const scaledWidth = customBackgroundImage.width * scale;
            const scaledHeight = customBackgroundImage.height * scale;
            const x = (canvas.width - scaledWidth) / 2;
            const y = (canvas.height - scaledHeight) / 2;
            
            // Draw the background image
            ctx.drawImage(customBackgroundImage, x, y, scaledWidth, scaledHeight);
            
            // Reset filter
            ctx.filter = 'none';
            
            // Add dark overlay for text readability
            ctx.fillStyle = `rgba(0, 0, 0, ${overlayOpacity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Restore context state
            ctx.restore();
        }

        function drawGradientBackground(template) {
            // Enhanced template styles with better elegance
            const templates = {
                minimal: {
                    background: ['#fafafa', '#ffffff'],
                    textColor: '#2c2c2c',
                    authorColor: '#757575',
                    accent: '#e0e0e0'
                },
                gradient: {
                    background: ['#667eea', '#764ba2'],
                    textColor: '#ffffff',
                    authorColor: '#f8f9ff',
                    accent: 'rgba(255,255,255,0.3)'
                },
                dark: {
                    background: ['#1a1a1a', '#2d3748'],
                    textColor: '#ffffff',
                    authorColor: '#cbd5e0',
                    accent: 'rgba(255,255,255,0.2)'
                },
                warm: {
                    background: ['#ffecd2', '#fcb69f'],
                    textColor: '#5d4037',
                    authorColor: '#8d6e63',
                    accent: 'rgba(93,64,55,0.2)'
                },
                nature: {
                    background: ['#d299c2', '#fef9d7'],
                    textColor: '#2e7d32',
                    authorColor: '#558b2f',
                    accent: 'rgba(46,125,50,0.2)'
                },
                ocean: {
                    background: ['#0083B0', '#00B4DB'],
                    textColor: '#ffffff',
                    authorColor: '#e0f7ff',
                    accent: 'rgba(255,255,255,0.3)'
                },
                sunset: {
                    background: ['#ff6b6b', '#feca57'],
                    textColor: '#ffffff',
                    authorColor: '#fff4e6',
                    accent: 'rgba(255,255,255,0.3)'
                },
                royal: {
                    background: ['#4b6cb7', '#182848'],
                    textColor: '#ffffff',
                    authorColor: '#d4e3ff',
                    accent: 'rgba(255,255,255,0.2)'
                },
                vintage: {
                    background: ['#c9a96e', '#a0826d'],
                    textColor: '#ffffff',
                    authorColor: '#f5e6d3',
                    accent: 'rgba(255,255,255,0.3)'
                },
                neon: {
                    background: ['#1a1a2e', '#16213e'],
                    textColor: '#00f5ff',
                    authorColor: '#ff007f',
                    accent: 'rgba(0,245,255,0.3)'
                },
                forest: {
                    background: ['#2d5016', '#3c6e1f'],
                    textColor: '#ffffff',
                    authorColor: '#c8d5b9',
                    accent: 'rgba(255,255,255,0.2)'
                },
                rose: {
                    background: ['#f093fb', '#f5576c'],
                    textColor: '#ffffff',
                    authorColor: '#ffe8f0',
                    accent: 'rgba(255,255,255,0.3)'
                }
            };

            const currentTemplate = templates[template];
            
            // Create elegant gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, currentTemplate.background[0]);
            gradient.addColorStop(1, currentTemplate.background[1]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add subtle texture overlay
            ctx.fillStyle = currentTemplate.accent;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawQuoteContent(text, author, template) {
            const customStyles = getCustomStyles();
            
            // Get template colors or use white text for custom images
            const templates = {
                minimal: {
                    textColor: '#2c2c2c',
                    authorColor: '#757575',
                    accent: '#e0e0e0'
                },
                gradient: {
                    textColor: '#ffffff',
                    authorColor: '#f8f9ff',
                    accent: 'rgba(255,255,255,0.3)'
                },
                dark: {
                    textColor: '#ffffff',
                    authorColor: '#cbd5e0',
                    accent: 'rgba(255,255,255,0.2)'
                },
                warm: {
                    textColor: '#5d4037',
                    authorColor: '#8d6e63',
                    accent: 'rgba(93,64,55,0.2)'
                },
                nature: {
                    textColor: '#2e7d32',
                    authorColor: '#558b2f',
                    accent: 'rgba(46,125,50,0.2)'
                },
                ocean: {
                    textColor: '#ffffff',
                    authorColor: '#e0f7ff',
                    accent: 'rgba(255,255,255,0.3)'
                },
                sunset: {
                    textColor: '#ffffff',
                    authorColor: '#fff4e6',
                    accent: 'rgba(255,255,255,0.3)'
                },
                royal: {
                    textColor: '#ffffff',
                    authorColor: '#d4e3ff',
                    accent: 'rgba(255,255,255,0.2)'
                },
                vintage: {
                    textColor: '#ffffff',
                    authorColor: '#f5e6d3',
                    accent: 'rgba(255,255,255,0.3)'
                },
                neon: {
                    textColor: '#00f5ff',
                    authorColor: '#ff007f',
                    accent: 'rgba(0,245,255,0.3)'
                },
                forest: {
                    textColor: '#ffffff',
                    authorColor: '#c8d5b9',
                    accent: 'rgba(255,255,255,0.2)'
                },
                rose: {
                    textColor: '#ffffff',
                    authorColor: '#ffe8f0',
                    accent: 'rgba(255,255,255,0.3)'
                }
            };

            // Use custom colors or template colors
            const defaultTemplate = customBackgroundImage ? 
                { textColor: '#ffffff', authorColor: '#f0f0f0', accent: 'rgba(255,255,255,0.3)' } : 
                templates[template];

            const textColor = customStyles.quoteColor || defaultTemplate.textColor;
            const authorColor = customStyles.authorColor || defaultTemplate.authorColor;
            const accentColor = defaultTemplate.accent;

            // Calculate font size - use custom or auto-calculate
            let quoteFontSize;
            if (customStyles.fontSize == 50) { // Auto mode
                const baseSize = calculateOptimalFontSize(text, canvas.width - 200, canvas.height - 300);
                quoteFontSize = Math.max(28, Math.min(baseSize, 72));
            } else {
                quoteFontSize = Math.max(20, Math.min(parseInt(customStyles.fontSize), 100));
            }
            
            const authorFontSize = Math.max(16, quoteFontSize * 0.45);
            
            // Build font string with custom styles
            let fontWeight = customStyles.isBold ? 'bold' : '400';
            let fontStyle = customStyles.isItalic ? 'italic' : 'normal';
            let fontFamily = customStyles.fontFamily || 'Playfair Display';
            
            // Set text properties
            ctx.textAlign = customStyles.textAlign || 'center';
            ctx.textBaseline = 'middle';
            
            // Create font string with proper fallbacks
            const quoteFontString = `${fontStyle} ${fontWeight} ${quoteFontSize}px "${fontFamily}", Georgia, serif`;
            ctx.font = quoteFontString;
            
            console.log('Applied font:', quoteFontString); // Debug log
            
            // Improved word wrapping algorithm
            const lines = wrapTextToLines(text, ctx, canvas.width - 200);
            
            // Calculate vertical positioning with custom spacing
            const lineHeight = quoteFontSize * customStyles.lineSpacing;
            const totalTextHeight = lines.length * lineHeight;
            const authorHeight = author ? authorFontSize * 2 : 0;
            const decorativeHeight = customStyles.showQuotes ? 60 : 30;
            const totalContentHeight = totalTextHeight + authorHeight + decorativeHeight;
            
            let startY = (canvas.height - totalContentHeight) / 2;
            
            // Adjust alignment
            let textX = canvas.width / 2;
            if (customStyles.textAlign === 'left') {
                textX = 100;
            } else if (customStyles.textAlign === 'right') {
                textX = canvas.width - 100;
            }
            
            // Add elegant opening quotation mark (if enabled)
            if (customStyles.showQuotes) {
                ctx.font = `${fontStyle} ${fontWeight} ${quoteFontSize * 1.8}px "${fontFamily}", Georgia, serif`;
                ctx.fillStyle = accentColor;
                const quoteOffset = customStyles.textAlign === 'center' ? 40 : 20;
                ctx.fillText('"', textX - quoteOffset, startY - quoteFontSize * 0.8);
            }
            
            // Set up text effects
            ctx.fillStyle = textColor;
            ctx.font = quoteFontString;
            
            // Apply text stroke if enabled
            if (customStyles.textStroke > 0) {
                ctx.strokeStyle = customStyles.strokeColor;
                ctx.lineWidth = customStyles.textStroke;
            }
            
            // Apply text shadow if enabled
            if (customStyles.textShadow > 0) {
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowOffsetX = customStyles.textShadow;
                ctx.shadowOffsetY = customStyles.textShadow;
                ctx.shadowBlur = customStyles.textShadow * 2;
            }
            
            // Draw quote text with custom styling
            lines.forEach((line, index) => {
                const yPos = startY + (index * lineHeight);
                
                // Draw stroke first if enabled
                if (customStyles.textStroke > 0) {
                    ctx.strokeText(line, textX, yPos);
                }
                
                // Draw fill text
                ctx.fillText(line, textX, yPos);
            });
            
            // Reset effects
            ctx.shadowColor = 'transparent';
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.shadowBlur = 0;
            
            // Add elegant closing quotation mark (if enabled)
            if (customStyles.showQuotes) {
                ctx.font = `${fontStyle} ${fontWeight} ${quoteFontSize * 1.8}px "${fontFamily}", Georgia, serif`;
                ctx.fillStyle = accentColor;
                const quoteOffset = customStyles.textAlign === 'center' ? 40 : 20;
                ctx.fillText('"', textX + quoteOffset, startY + totalTextHeight - quoteFontSize * 0.3);
            }
            
            // Draw decorative line separator
            const decorY = startY + totalTextHeight + 30;
            drawDecorativeLine(ctx, textX, decorY, accentColor);
            
            // Draw author with custom styling
            if (author) {
                ctx.fillStyle = authorColor;
                const authorFontString = `italic ${authorFontSize}px "${fontFamily}", Georgia, serif`;
                ctx.font = authorFontString;
                
                // Apply same effects to author text
                if (customStyles.textShadow > 0) {
                    ctx.shadowColor = 'rgba(0,0,0,0.2)';
                    ctx.shadowOffsetX = customStyles.textShadow / 2;
                    ctx.shadowOffsetY = customStyles.textShadow / 2;
                    ctx.shadowBlur = customStyles.textShadow;
                }
                
                ctx.fillText(`— ${author}`, textX, decorY + 40);
                
                // Reset shadow
                ctx.shadowColor = 'transparent';
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                ctx.shadowBlur = 0;
            }

            // Draw watermark if enabled
            if (customStyles.enableWatermark) {
                if (customStyles.watermarkType === 'text' && customStyles.watermarkText.trim()) {
                    drawTextWatermark(customStyles);
                } else if (customStyles.watermarkType === 'logo' && logoImage) {
                    drawLogoWatermark(customStyles);
                }
            }

            // Draw QR code if enabled
            if (customStyles.enableQR && qrCodeDataURL) {
                drawQRCode(customStyles);
            }
        }

        function drawTextWatermark(styles) {
            if (!styles.watermarkText.trim()) return;

            // Save current context state
            ctx.save();

            // Set watermark properties
            const watermarkSize = styles.watermarkSize;
            const opacity = styles.watermarkOpacity / 100;
            
            ctx.font = `${watermarkSize}px "Inter", Arial, sans-serif`;
            ctx.fillStyle = styles.watermarkColor;
            ctx.globalAlpha = opacity;

            // Calculate position
            const padding = 20;
            const textMetrics = ctx.measureText(styles.watermarkText);
            const textWidth = textMetrics.width;
            const textHeight = watermarkSize;

            let x, y;
            
            switch (styles.watermarkPosition) {
                case 'bottom-right':
                    x = canvas.width - textWidth - padding;
                    y = canvas.height - padding;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'bottom';
                    break;
                case 'bottom-left':
                    x = padding;
                    y = canvas.height - padding;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'bottom';
                    break;
                case 'top-right':
                    x = canvas.width - textWidth - padding;
                    y = padding + textHeight;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'top';
                    break;
                case 'top-left':
                    x = padding;
                    y = padding + textHeight;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'top';
                    break;
                case 'bottom-center':
                    x = canvas.width / 2;
                    y = canvas.height - padding;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    break;
                default:
                    x = canvas.width - textWidth - padding;
                    y = canvas.height - padding;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'bottom';
            }

            // Draw watermark text
            ctx.fillText(styles.watermarkText, x, y);

            // Restore context state
            ctx.restore();
        }

        function drawLogoWatermark(styles) {
            if (!logoImage) return;

            // Save current context state
            ctx.save();

            // Set opacity
            const opacity = styles.watermarkOpacity / 100;
            ctx.globalAlpha = opacity;

            // Calculate logo dimensions
            const logoSize = styles.logoSize;
            const aspectRatio = logoImage.width / logoImage.height;
            let logoWidth, logoHeight;

            if (aspectRatio > 1) {
                // Landscape logo
                logoWidth = logoSize;
                logoHeight = logoSize / aspectRatio;
            } else {
                // Portrait or square logo
                logoHeight = logoSize;
                logoWidth = logoSize * aspectRatio;
            }

            // Calculate position
            const padding = 20;
            let x, y;

            switch (styles.watermarkPosition) {
                case 'bottom-right':
                    x = canvas.width - logoWidth - padding;
                    y = canvas.height - logoHeight - padding;
                    break;
                case 'bottom-left':
                    x = padding;
                    y = canvas.height - logoHeight - padding;
                    break;
                case 'top-right':
                    x = canvas.width - logoWidth - padding;
                    y = padding;
                    break;
                case 'top-left':
                    x = padding;
                    y = padding;
                    break;
                case 'bottom-center':
                    x = (canvas.width - logoWidth) / 2;
                    y = canvas.height - logoHeight - padding;
                    break;
                default:
                    x = canvas.width - logoWidth - padding;
                    y = canvas.height - logoHeight - padding;
            }

            // Draw logo
            ctx.drawImage(logoImage, x, y, logoWidth, logoHeight);

            // Restore context state
            ctx.restore();
        }

        function drawQRCode(styles) {
            if (!qrCodeDataURL) return;

            const qrImage = new Image();
            qrImage.onload = function() {
                // Save context state
                ctx.save();

                const qrSize = styles.qrSize;
                const padding = 15;
                let x, y;

                switch (styles.qrPosition) {
                    case 'bottom-right':
                        x = canvas.width - qrSize - padding;
                        y = canvas.height - qrSize - padding;
                        break;
                    case 'bottom-left':
                        x = padding;
                        y = canvas.height - qrSize - padding;
                        break;
                    case 'top-right':
                        x = canvas.width - qrSize - padding;
                        y = padding;
                        break;
                    case 'top-left':
                        x = padding;
                        y = padding;
                        break;
                    default:
                        x = canvas.width - qrSize - padding;
                        y = canvas.height - qrSize - padding;
                }

                // Draw background if specified
                if (styles.qrBackground !== 'transparent') {
                    ctx.fillStyle = styles.qrBackground === 'custom' ? styles.qrBgColor : '#ffffff';
                    ctx.fillRect(x - 5, y - 5, qrSize + 10, qrSize + 10);
                }

                // Draw QR code
                ctx.drawImage(qrImage, x, y, qrSize, qrSize);

                // Restore context state
                ctx.restore();
            };
            qrImage.src = qrCodeDataURL;
        }

        function calculateOptimalFontSize(text, maxWidth, maxHeight) {
            const testCanvas = document.createElement('canvas');
            const testCtx = testCanvas.getContext('2d');
            const customStyles = getCustomStyles();
            const fontFamily = customStyles.fontFamily || 'Playfair Display';
            const fontWeight = customStyles.isBold ? 'bold' : '400';
            const fontStyle = customStyles.isItalic ? 'italic' : 'normal';
            const lineSpacing = customStyles.lineSpacing || 1.4;
            
            // Adjust font size range based on canvas dimensions
            const canvasArea = canvas.width * canvas.height;
            const baseArea = 1080 * 1080; // Instagram post size as baseline
            const scaleFactor = Math.sqrt(canvasArea / baseArea);
            
            const maxFontSize = Math.min(120, Math.max(40, 72 * scaleFactor));
            const minFontSize = Math.min(40, Math.max(16, 20 * scaleFactor));
            
            for (let size = maxFontSize; size >= minFontSize; size -= 2) {
                testCtx.font = `${fontStyle} ${fontWeight} ${size}px "${fontFamily}", Georgia, serif`;
                const lines = wrapTextToLines(text, testCtx, maxWidth);
                const totalHeight = lines.length * size * lineSpacing;
                
                if (totalHeight <= maxHeight) {
                    return size;
                }
            }
            return minFontSize;
        }

        // Style presets
        function applyPreset() {
            const preset = document.getElementById('style-presets').value;
            if (!preset) return;

            const presets = {
                elegant: {
                    fontFamily: 'Playfair Display',
                    bold: false,
                    italic: false,
                    textAlign: 'center',
                    fontSize: 50,
                    lineSpacing: 1.5,
                    quoteColor: '#2c2c2c',
                    authorColor: '#666666',
                    textShadow: 1,
                    textStroke: 0,
                    showQuotes: true
                },
                modern: {
                    fontFamily: 'Inter',
                    bold: false,
                    italic: false,
                    textAlign: 'left',
                    fontSize: 45,
                    lineSpacing: 1.3,
                    quoteColor: '#1a1a1a',
                    authorColor: '#555555',
                    textShadow: 0,
                    textStroke: 0,
                    showQuotes: false
                },
                bold: {
                    fontFamily: 'Oswald',
                    bold: true,
                    italic: false,
                    textAlign: 'center',
                    fontSize: 55,
                    lineSpacing: 1.2,
                    quoteColor: '#000000',
                    authorColor: '#333333',
                    textShadow: 2,
                    textStroke: 1,
                    strokeColor: '#ffffff',
                    showQuotes: false
                },
                script: {
                    fontFamily: 'Dancing Script',
                    bold: false,
                    italic: false,
                    textAlign: 'center',
                    fontSize: 60,
                    lineSpacing: 1.4,
                    quoteColor: '#8b4513',
                    authorColor: '#a0522d',
                    textShadow: 2,
                    textStroke: 0,
                    showQuotes: true
                },
                professional: {
                    fontFamily: 'Merriweather',
                    bold: false,
                    italic: false,
                    textAlign: 'center',
                    fontSize: 42,
                    lineSpacing: 1.5,
                    quoteColor: '#2c3e50',
                    authorColor: '#7f8c8d',
                    textShadow: 1,
                    textStroke: 0,
                    showQuotes: true
                },
                social: {
                    fontFamily: 'Montserrat',
                    bold: true,
                    italic: false,
                    textAlign: 'center',
                    fontSize: 48,
                    lineSpacing: 1.3,
                    quoteColor: '#e74c3c',
                    authorColor: '#34495e',
                    textShadow: 3,
                    textStroke: 1,
                    strokeColor: '#ffffff',
                    showQuotes: false
                }
            };

            const settings = presets[preset];
            if (settings) {
                // Apply all settings
                document.getElementById('font-family').value = settings.fontFamily;
                document.getElementById('text-bold').checked = settings.bold;
                document.getElementById('text-italic').checked = settings.italic;
                document.getElementById('text-align').value = settings.textAlign;
                document.getElementById('font-size').value = settings.fontSize;
                document.getElementById('line-spacing').value = settings.lineSpacing;
                document.getElementById('quote-color').value = settings.quoteColor;
                document.getElementById('author-color').value = settings.authorColor;
                document.getElementById('text-shadow').value = settings.textShadow;
                document.getElementById('text-stroke').value = settings.textStroke;
                if (settings.strokeColor) {
                    document.getElementById('stroke-color').value = settings.strokeColor;
                }
                document.getElementById('show-quotes').checked = settings.showQuotes;

                // Update displays
                updateFontSizeDisplay();
                updateLineSpacingDisplay();
                updateShadowDisplay();
                updateStrokeDisplay();
                updateWatermarkOpacityDisplay();
                updateWatermarkSizeDisplay();
                
                // Update preview
                updatePreview();
            }
        }

        // Font loading function
        function loadGoogleFonts() {
            const link = document.createElement('link');
            link.href = 'https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Lora:ital,wght@0,400;0,700;1,400&family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Oswald:wght@400;600&family=Dancing+Script:wght@400;700&family=Bebas+Neue&display=swap';
            link.rel = 'stylesheet';
            document.head.appendChild(link);
            
            // Wait for fonts to load before enabling preview
            setTimeout(() => {
                console.log('Fonts should be loaded now');
            }, 1000);
        }

        // Initialize displays on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGoogleFonts();
            updateFontSizeDisplay();
            updateLineSpacingDisplay();
            updateShadowDisplay();
            updateStrokeDisplay();
            updateWatermarkOpacityDisplay();
            updateWatermarkSizeDisplay();
            updateLogoSizeDisplay();
            updateQRSizeDisplay();
            initializeTemplateLibrary();
            
            // Initialize QR code generation on URL change
            document.getElementById('qr-url').addEventListener('input', generateQRCode);
            document.getElementById('enable-qr').addEventListener('change', function() {
                if (this.checked) {
                    generateQRCode();
                }
            });
            
            // Toggle QR background color input visibility
            document.getElementById('qr-background').addEventListener('change', function() {
                const colorGroup = document.getElementById('qr-color-group');
                colorGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            });
        });

        function wrapTextToLines(text, ctx, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';
            
            for (let word of words) {
                const testLine = currentLine + (currentLine ? ' ' : '') + word;
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && currentLine) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = testLine;
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }

        function drawDecorativeLine(ctx, centerX, y, color) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            // Draw elegant decorative line with ornaments
            ctx.beginPath();
            ctx.moveTo(centerX - 80, y);
            ctx.lineTo(centerX - 20, y);
            ctx.moveTo(centerX + 20, y);
            ctx.lineTo(centerX + 80, y);
            ctx.stroke();
            
            // Add center ornament
            ctx.beginPath();
            ctx.arc(centerX, y, 4, 0, 2 * Math.PI);
            ctx.fillStyle = color;
            ctx.fill();
        }

        async function copyToClipboard() {
            try {
                // Convert canvas to blob
                const blob = await new Promise(resolve => {
                    canvas.toBlob(resolve, 'image/png');
                });
                
                // Copy to clipboard using modern API
                if (navigator.clipboard && window.ClipboardItem) {
                    const clipboardItem = new ClipboardItem({ 'image/png': blob });
                    await navigator.clipboard.write([clipboardItem]);
                    
                    // Show success feedback
                    showCopyFeedback('✅ Copied to clipboard!');
                } else {
                    // Fallback for older browsers
                    const dataUrl = canvas.toDataURL('image/png');
                    await navigator.clipboard.writeText(dataUrl);
                    showCopyFeedback('✅ Image data copied! (Paste as data URL)');
                }
            } catch (err) {
                console.error('Failed to copy to clipboard:', err);
                
                // Alternative fallback - create temporary download
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = 'quote.png';
                link.click();
                
                showCopyFeedback('⚠️ Clipboard not supported - Downloaded instead');
            }
        }

        function showCopyFeedback(message) {
            const button = document.querySelector('.copy-clipboard');
            const originalText = button.textContent;
            
            button.textContent = message;
            button.style.background = '#4CAF50';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#9c27b0';
            }, 2000);
        }

        function downloadQuote(format) {
            const link = document.createElement('a');
            const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            const sizeName = canvasSizes[currentCanvasSize].name.toLowerCase().replace(/\s+/g, '-');
            link.download = `quote-${sizeName}-${canvas.width}x${canvas.height}.${format}`;
            link.href = canvas.toDataURL(mimeType, 0.9);
            link.click();
        }

        // Template Library Functions
        function initializeTemplateLibrary() {
            populateTemplateGrid();
        }

        function populateTemplateGrid() {
            const grid = document.getElementById('template-grid');
            grid.innerHTML = '';

            const allTemplates = [];
            Object.values(quoteTemplates).forEach(category => {
                allTemplates.push(...category);
            });

            allTemplates.forEach(template => {
                const templateCard = createTemplateCard(template);
                grid.appendChild(templateCard);
            });
        }

        function createTemplateCard(template) {
            const card = document.createElement('div');
            card.className = `template-card template-${template.theme}`;
            card.setAttribute('data-category', template.category);
            card.onclick = () => applyTemplate(template);

            card.innerHTML = `
                <div class="template-preview">
                    <div class="template-text" style="font-family: '${template.style.fontFamily}'; text-align: ${template.style.textAlign}; font-weight: ${template.style.isBold ? 'bold' : 'normal'};">
                        "${template.sampleText}"
                    </div>
                </div>
                <div class="template-info">
                    <h4>${template.name}</h4>
                    <p>${template.description}</p>
                </div>
            `;

            return card;
        }

        function filterTemplates(category) {
            const cards = document.querySelectorAll('.template-card');
            const buttons = document.querySelectorAll('.category-btn');

            // Update active button
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });

            // Filter templates
            cards.forEach(card => {
                if (category === 'all' || card.getAttribute('data-category') === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function applyTemplate(template) {
            // Apply template styling
            document.getElementById('font-family').value = template.style.fontFamily;
            document.getElementById('text-bold').checked = template.style.isBold;
            document.getElementById('text-italic').checked = template.style.isItalic || false;
            document.getElementById('text-align').value = template.style.textAlign;
            document.getElementById('line-spacing').value = template.style.lineSpacing;
            document.getElementById('quote-color').value = template.style.quoteColor;
            document.getElementById('text-shadow').value = template.style.textShadow;
            document.getElementById('show-quotes').checked = template.style.showQuotes;

            // Set font size
            if (template.style.fontSize === 'auto') {
                document.getElementById('font-size').value = 50; // Auto mode
            } else {
                document.getElementById('font-size').value = template.style.fontSize;
            }

            // Apply theme
            const themeOption = document.querySelector(`.template-option[data-template="${template.theme}"]`);
            if (themeOption) {
                document.querySelectorAll('.template-option').forEach(opt => opt.classList.remove('selected'));
                themeOption.classList.add('selected');
                selectedTemplate = template.theme;
            }

            // Update displays
            updateFontSizeDisplay();
            updateLineSpacingDisplay();
            updateShadowDisplay();

            // Update preview
            updatePreview();

            // Show feedback
            showTemplateFeedback(`✅ Applied ${template.name} template!`);
        }

        function showTemplateFeedback(message) {
            // Create temporary feedback element
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                font-weight: bold;
            `;
            feedback.textContent = message;
            document.body.appendChild(feedback);

            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 3000);
        }

        // QR Code Functions
        async function generateQRCode() {
            const qrUrl = document.getElementById('qr-url').value.trim();
            if (!qrUrl) return;

            try {
                const qrCanvas = document.createElement('canvas');
                await QRCode.toCanvas(qrCanvas, qrUrl, {
                    width: 200,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
                qrCodeDataURL = qrCanvas.toDataURL();
            } catch (error) {
                console.error('QR Code generation failed:', error);
                qrCodeDataURL = null;
            }
        }

        function updateQRSizeDisplay() {
            const size = document.getElementById('qr-size').value;
            document.getElementById('qr-size-value').textContent = size + 'px';
        }

        // Enhanced getCustomStyles function to include QR settings
        function getCustomStyles() {
            const styles = {
                fontFamily: document.getElementById('font-family').value,
                isBold: document.getElementById('text-bold').checked,
                isItalic: document.getElementById('text-italic').checked,
                textAlign: document.getElementById('text-align').value,
                fontSize: parseInt(document.getElementById('font-size').value),
                lineSpacing: parseFloat(document.getElementById('line-spacing').value),
                quoteColor: document.getElementById('quote-color').value,
                authorColor: document.getElementById('author-color').value,
                textShadow: parseInt(document.getElementById('text-shadow').value),
                textStroke: parseInt(document.getElementById('text-stroke').value),
                strokeColor: document.getElementById('stroke-color').value,
                showQuotes: document.getElementById('show-quotes').checked,
                enableWatermark: document.getElementById('enable-watermark').checked,
                watermarkType: document.getElementById('watermark-type').value,
                watermarkText: document.getElementById('watermark-text').value,
                watermarkPosition: document.getElementById('watermark-position').value,
                watermarkOpacity: parseInt(document.getElementById('watermark-opacity').value),
                watermarkSize: parseInt(document.getElementById('watermark-size').value),
                watermarkColor: document.getElementById('watermark-color').value,
                logoSize: parseInt(document.getElementById('logo-size').value),
                enableQR: document.getElementById('enable-qr').checked,
                qrPosition: document.getElementById('qr-position').value,
                qrSize: parseInt(document.getElementById('qr-size').value),
                qrBackground: document.getElementById('qr-background').value,
                qrBgColor: document.getElementById('qr-bg-color').value
            };
            return styles;
        }
    </script>
</body>
</html>